import{_ as e,r as o,o as c,c as i,a as n,b as s,d as t,e as p}from"./app.cc3919a2.js";const l={},u=p('<h1 id="å•ç‚¹ç™»å½•" tabindex="-1"><a class="header-anchor" href="#å•ç‚¹ç™»å½•" aria-hidden="true">#</a> å•ç‚¹ç™»å½•</h1><h2 id="å‰ç«¯å®ç°æ­¥éª¤åˆ’åˆ†" tabindex="-1"><a class="header-anchor" href="#å‰ç«¯å®ç°æ­¥éª¤åˆ’åˆ†" aria-hidden="true">#</a> å‰ç«¯å®ç°æ­¥éª¤åˆ’åˆ†</h2><p>å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºå•ç‚¹ç™»å½•ï¼Œä¸ä¸ºåˆ™ç›´æ¥è¿”å›ä¸å†è¿›è¡Œä»»ä½•é€»è¾‘å¤„ç†ï¼Œä¸‹é¢æ˜¯å•ç‚¹ç™»å½•çš„å¤„ç†æ­¥éª¤</p><div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p>é¦–å…ˆéœ€è¦åœ¨åå°é…ç½® <code>distinguishVersion</code> å­—æ®µé…åˆä½¿ç”¨æ‰å¯è§¦å‘å•ç‚¹ç™»å½•</p></div>',4),r={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso-config.js#L21",target:"_blank",rel:"noopener noreferrer"},k=n("code",null,"key",-1),d=n("code",null,"must",-1),v=n("code",null,"validateParams",-1),m=n("code",null,"loginAsync",-1),b=n("code",null,"getUserInfo",-1),g={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso.js#L6",target:"_blank",rel:"noopener noreferrer"},f=n("code",null,"sso-config",-1),h=n("code",null,"validateParams",-1),y=n("code",null,"loginAsync",-1),w={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso.js#L18",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,"url",-1),x={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso.js#L30",target:"_blank",rel:"noopener noreferrer"},j=n("code",null,"window.location.replace",-1),S=n("code",null,"window.location.replace",-1),C=n("h2",{id:"ä¸»è¦ä»£ç ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¸»è¦ä»£ç ","aria-hidden":"true"},"#"),s(" ä¸»è¦ä»£ç ")],-1),V={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso-config.js",target:"_blank",rel:"noopener noreferrer"},U=p(`<details class="custom-container details"><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;./http&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">&#39;../api/user&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> UseUserStore <span class="token keyword">from</span> <span class="token string">&#39;@/stores/modules/user&#39;</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * key: 1:é»˜è®¤,2:æ±Ÿè‹çœå…,3:æ²³åŒ—(çŸ³å®¶åº„),4:å››å·çœå…,5:å†…æ±Ÿå¸‚å±€,6:å››å·é«˜æ–°åŒº,7:æµå—å¸‚å±€,8:ç”˜è‚ƒçœå…,9:å…°å·,10:ä¹Œå¸‚
 * å±æ€§ validateParams: æ ¡éªŒå¯¹åº”å‚æ•°æ˜¯å¦å­˜åœ¨
 * å±æ€§ loginAsync: å¯¹åº”çš„ç™»é™†æ–¹æ³•
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">validateMust</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> must</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mustLength <span class="token operator">=</span> must<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> mustLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>must<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    start<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ssoConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&#39;4&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">must</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">validateParams</span><span class="token operator">:</span> validateMust<span class="token punctuation">,</span>
    <span class="token function-variable function">loginAsync</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> userStore <span class="token operator">=</span> <span class="token function">UseUserStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>tokenWsUniportalCheck<span class="token punctuation">,</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userStore<span class="token punctuation">.</span><span class="token function">setSystemData</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;isSSO&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;ç¬¬ä¸‰æ–¹ç™»å½•æˆåŠŸ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&#39;err&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getUserInfo</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userWsInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&#39;err&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ssoConfig<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>`,1),L={href:"http://192.168.1.123:10080/platform/qsdi/web-basic/-/blob/master/src/config/http/sso.js",target:"_blank",rel:"noopener noreferrer"},q=p(`<details class="custom-container details"><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getRegust <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/utils/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ssoConfig <span class="token keyword">from</span> <span class="token string">&#39;./sso-config&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> UseCommonStore <span class="token keyword">from</span> <span class="token string">&#39;@/stores/modules/common&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ssoLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">getRegust</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> commonStore <span class="token operator">=</span> <span class="token function">UseCommonStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> distinguishVersion <span class="token operator">=</span> commonStore<span class="token punctuation">.</span>systemConfig<span class="token punctuation">.</span>distinguishVersion<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span>distinguishVersion <span class="token operator">||</span>
    <span class="token operator">!</span>ssoConfig<span class="token punctuation">[</span>distinguishVersion<span class="token punctuation">]</span> <span class="token operator">||</span>
    <span class="token operator">!</span>ssoConfig<span class="token punctuation">[</span>distinguishVersion<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">validateParams</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> ssoConfig<span class="token punctuation">[</span>distinguishVersion<span class="token punctuation">]</span><span class="token punctuation">.</span>must<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> ssoConfig<span class="token punctuation">[</span>distinguishVersion<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">loginAsync</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

  ssoConfig<span class="token punctuation">[</span>distinguishVersion<span class="token punctuation">]</span><span class="token punctuation">.</span>must<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> params<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> newUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>location<span class="token punctuation">.</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[&quot;{}]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">:</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">,</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&amp;&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ›¿æ¢å†å²è®°å½•é¡¹</span>
      window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ssoLogin<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="url-ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#url-ä½¿ç”¨" aria-hidden="true">#</a> url ä½¿ç”¨</h2><p>ä¸¾ä¸ªğŸŒ°</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>å®Œæ•´åœ°å€ http://127.0.0.1:8888/login?token=001

http://127.0.0.1:8888 åŸŸå

/login è¦è·³è½¬çš„é¡µé¢(è¿™é‡Œæ˜¯historyæ¨¡å¼)

?token=001 æ˜¯éœ€è¦çš„å•ç‚¹ç™»å½•çš„å¿…è¦å‚æ•°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function I(P,A){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("â‘  "),n("a",r,[s("é…ç½®å•ç‚¹ç™»å½•"),t(a)]),s(" å…¶ä¸­ "),k,s(" åº”è¯¥å¯¹åº”é…ç½®çš„é¡¹ç›®ï¼Œ"),d,s(" ä¸ºå¿…é¡»è¦åœ¨æµè§ˆå™¨ä¸­çš„å‚æ•°ï¼Œ "),v,s(" ä¸ºå•ç‚¹ç™»å½•æ‰€éœ€çš„å‚æ•°æ ¡éªŒï¼Œ"),m,s(" ä¸ºå•ç‚¹ç™»å½•éœ€è¦å¼‚æ­¥ç™»é™†åçš„å¤„ç†ï¼Œ"),b,s(" ä¸ºè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™ç­‰ã€‚")]),n("p",null,[s("â‘¡ "),n("a",g,[s("è·å–urlä¸­çš„ä¿¡æ¯"),t(a)]),s(" æ ¹æ®ç³»ç»Ÿæ•°æ®åº“ä¸­é…ç½®çš„ä¿¡æ¯å’Œ "),f,s(" æ–‡ä»¶ä¸­å¯¹æ¯”ï¼Œ ä»¥åŠ "),h,s(" æ ¡éªŒé€šè¿‡ï¼Œè°ƒç”¨å•ç‚¹ç™»å½•å‡½æ•° "),y]),n("p",null,[s("â‘¢ "),n("a",w,[s("åˆ é™¤ä¸éœ€è¦æ˜¾ç¤ºåœ¨ "),_,s(" ä¸­çš„å‚æ•°"),t(a)])]),n("p",null,[s("â‘£ "),n("a",x,[s("ä½¿ç”¨ "),j,s(" è·³è½¬æ­£ç¡®é¡µé¢ï¼Œ"),S,s(" å¯ä»¥æ›¿æ¢æµè§ˆå™¨å†å²è®°å½•é¡¹"),t(a)])]),C,n("p",null,[n("a",V,[s("sso-config.js"),t(a)])]),U,n("p",null,[n("a",L,[s("sso.js"),t(a)])]),q])}const E=e(l,[["render",I],["__file","index.html.vue"]]);export{E as default};
